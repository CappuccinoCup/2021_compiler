# LLVM Based Simple Compiler

## Description
FDU 2021 autumn semester Compiler course serial lab. The goal is to complete a LLVM based compiler that can compile C-like simple program.

## Usage
Environment configuration please refer to /document/lab3.pdf.

To compile and run:

```shell
clang++ -g -O3 lab.cpp `llvm-config --cxxflags --ldflags --system-libs --libs all` -std=c++17 -o lab

./lab input_example.data # Generate file "output.o" (Our goal)

clang++ main.cpp output.o -o main # Link

./main # Run
```

## Goal

Our goal is to complete these rules:

```
<program>		::= <gdecl>*<def>*<function>*

<gdecl> 		::= extern <prototype>;
<def>			::= unary <any><intconst><type>(<type><ident>)<body>
					|binary <any><intconst><type>(<type><ident>,<type><ident>)<body>
<function> 		::= <prototype><body>

<prototype> 	::= <type><ident>(<paramlist>)
<paramlist> 	::= ε|<type><ident>[,<type><ident>]*
<body>			::= {[<stmt>]*}
<stmt>			::= <decl>;|<simp>;|<control>|<return>;

<decl>			::= <type><ident>[=<exp>][,<ident>[=<exp>]]*
<simp>			::= <ident>=<exp>
<control>		::= if(<exp>)<block>[else<block>]
					|while(<exp>)<block>
					|for([<decl>];[<exp>];[<simp>])<block>
<block>			::= <stmt>|{[<stmt>]*}
<return>		::= return <exp>

<exp>			::= (<exp>)|<const>|<ident>
					|<exp><binop><exp>|<unop><exp>
					|<callee>
<callee>		::= <ident>(ε|<exp>[,<exp>]*)

<type>			::= int|double|char
<ident>			::= [A-Z_a-z][0-9A-Z_a-z]*
<const>			::= <intconst>|<doubleconst>|<charconst>
<unop>			::= <any>
<binop>			::= +|-|*|<|==|!=|<=|<any>
<intconst>		::= [0-9][0-9]*
<doubleconst>	::=	<intconst>.<intconst>
<charconst>		::= '<any>'
<any>			::= [^\n]
```

Compared to the baseline of Lab5, we add these features:

1. Support type "char", e.g., char a; a = 'a';.
2. Support control flow "for".
3. Support a block instead of a single statement in control flow.
4. Support assignment in declaration statement, e.g., char a = 'a', b = 'b';.
5. Support binary operation "==", "!=" & "<=".
6. Support comment start with "#".
7. Support user-defined unary & binary operators. (\<def\> above).


## Files

`input_example.data` is the C-like program for our compiler to compile.

`output_example.data` is the execution output of main.cpp.

`output.o` is the binary file generated by our compiler.

`main.cpp` contains the main function to run the functions in output.o.

`lab.cpp` is the source file of our compiler.

`/test` contains more test cases.

`/document` contains the lab documents from lab1 to lab5.

## Reference
1. Lab documents (/document/*.pdf)
2. [LLVM Tutorial](https://llvm.org/docs/tutorial/index.html)